document.addEventListener("alpine:init",()=>{window.Alpine.data("tableOfContents",o=>({show:!0,showTopBar:!1,showBackToTop:!1,items:o.items,jumpToOffset:32,isJumping:!1,scrollY:window.scrollY,scrollProgress:0,scrollDirection:null,debounceTimer:null,activeId:window.location.hash.replace("#",""),asideToggleInteracted:!1,init(){window.addEventListener("popstate",()=>{this.isJumping=!0,this.activeId=window.location.hash.replace("#","")}),window.addEventListener("scroll",()=>{if(this.isJumping){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.isJumping=!1},200);return}this.scrollDirection=window.scrollY>this.scrollY?"down":"up",this.scrollY=window.scrollY,this.scrollProgress=this.getProgressBarValue(),this.syncScrollState(),this.showTopBar=this.scrollProgress>0,this.showBackToTop=this.isFirstSectionVisible()})},get currentItemTop(){return this.activeId?document.querySelector(`#${CSS.escape(this.activeId)}`).getBoundingClientRect().top-this.jumpToOffset:0},getProgressBarValue(){const t=document.querySelector(".js-TableOfContents"),e=t.getBoundingClientRect().top-this.jumpToOffset,s=Math.floor(e/t.scrollHeight*100)*-1,i=s>0?s:0;return Math.min(i,100)},syncScrollState(){const t=this.items.find(e=>{const s=document.querySelector(`#${CSS.escape(e.id)}`);if(!s)return!1;const i=s.getBoundingClientRect(),n=this.getAbsoluteTop(s);return i.bottom>=0&&i.right>=0&&i.top<=(window.innerHeight||document.documentElement.clientHeight)&&i.left<=(window.innerWidth||document.documentElement.clientWidth)&&n<=window.scrollY});t?this.setActive(t.id):this.currentItemTop>0&&this.setActive(this.getPrevItemId(this.activeId))},setActive(t){this.activeId=t;const e=t?`#${t}`:" ";history.replaceState(null,null,e)},isActive(t){return this.activeId===t},jumpTo(t){const e=document.querySelector(`#${CSS.escape(t)}`);if(e){this.isJumping=!0;const s=this.getAbsoluteTop(e)+1;window.scrollTo({top:s,behavior:"smooth"}),this.activeId=t,history.pushState(null,null,`#${t}`)}},getPrevItemId(t){const e=this.items.findIndex(s=>s.id===t);return e>0?this.items[e-1].id:null},getNextItemId(t){const e=this.items.findIndex(s=>s.id===t);return e<this.items.length-1?this.items[e+1].id:null},focusNext(t){const e=this.$event.target.dataset.id,s=this.getNextItemId(e);s&&(this.$root.querySelector(`a[data-id='${s}'`).focus(),t&&this.jumpTo(s))},focusPrev(t){const e=this.$event.target.dataset.id,s=this.getPrevItemId(e);s?(this.$root.querySelector(`a[data-id='${s}'`).focus(),t&&this.jumpTo(s)):this.$refs.toggleBtn.focus()},backToTop(){window.scrollTo({top:0,behavior:"smooth"})},asideToggleClicked(){this.asideToggleInteracted=!0,this.show=!this.show},isFirstSectionVisible(){try{const t=document.querySelector(".js-ArticleBody .below-the-fold-layout__section");if(!t)return!1;const{top:e}=t.getBoundingClientRect();return e<=0}catch{return!1}},getAbsoluteTop(t){const e=t.getBoundingClientRect().top,s=window.scrollY||document.documentElement.scrollTop;return Math.floor(e+s)-this.jumpToOffset}}))});
