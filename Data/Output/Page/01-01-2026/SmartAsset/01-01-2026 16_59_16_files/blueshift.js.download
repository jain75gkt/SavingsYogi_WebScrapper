!function(){var t=("https:"===document.location.protocol?"https:":"http:")+"//"+(window._bsfthost||"api.getblueshift.com")+"/",l=t+"unity.gif",n=!1,f="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,d={},h={open:"o",click:"c",dismiss:"d"};var o,m={eventApiKey:void 0,userParams:{},slots:[],slotParams:{},tz:(new Date).getTimezoneOffset()};function i(){for(var a=[],e=0;e<m.slots.length;e++)!function(s){a[s]=y(),a[s].open("POST",t+"live",!0),a[s].setRequestHeader("Content-Type","application/json"),a[s].onreadystatechange=function(){if(4===a[s].readyState&&200==a[s].status){try{var e=JSON.parse(a[s].responseText)}catch(e){console.debug("error loading slot",e)}!function(e){if(!0!==e?.show)return!1;if(!e?.message_filters?.length)return!0;for(var t=b("_bsft_message_actions")||"{}",n=JSON.parse(t),o=0;o<e.message_filters.length;o++){var i=e.message_filters[o],r=h[i.action]||i.action,s=i.experiment_uuid.substring(0,8)+"."+r,r=i.experiment_uuid+"."+i.action,a=n[s]||n[r];if(a){for(var c=0,u=0;u<a.length;u++){var l=a[u];l<i.unix_time_start||l>i.unix_time_end||c++}if(0<(i.min_occurrences||0)+(i.max_occurrences||0)){if(!(c<(i.min_occurrences||0)||null!==i.max_occurrences&&c>i.max_occurrences))return!1}else if(0<c)return!1}}return!0}(e)?console.debug("no render for res"):e.lightbox?(t=m.slots[s].el,n=e.width,o=e.height,i=e.content,r=e.lightbox_config,function(e,t,n,o,i){var r="https://cdn.getblueshift.com/live/modal.js";document.getElementById(r)&&renderLightbox(e,t,n,o,i);var s=document.createElement("script");s.id=r,s.src=r,s.async=!0,s.onload=()=>{renderLightbox(e,t,n,o,i)},document.body.append(s)}(t,n,o,i,r)):(n=m.slots[s].el,o=e.width,i=e.height,r=e.content,e=document.createElement("iframe"),n.innerHTML="",n.appendChild(e),e.src="about:blank",e.style.width=o,e.style.height=i,e.style.border="none",e.contentWindow.document.open(),e.contentWindow.document.write(r),e.contentWindow.document.close(),n.style.width=o,n.style.height=i,n.style.display="block",function(e){try{const t=e.contentDocument||e.contentWindow.document,n=t.querySelectorAll('img[style="display:none"][src*="/track?"]');n.forEach(e=>{const t=new URL(e.src);var n=t.searchParams.get("eid"),e=t.searchParams.get("a");"open"===e&&g(n,e)}),t.addEventListener("click",function(e){e=e.target;if(e&&"A"===e.tagName){const t=new URL(e.href);e=t.searchParams.get("eid");e&&g(e,"click")}})}catch(e){console.debug("Error initializing iframe tracking:",e)}}(e))}var t,n,o,i,r},m.slotParams[m.slots[s].name]||(m.slotParams[m.slots[s].name]={}),a[s].send(function(e,t){t.tz=m.tz,t.href=window.location.href;var n=b("_bs_hash");return n&&(m.userParams.cookie_hash=n),t={x:m.eventApiKey,slot:e,user:m.userParams,context:t},"true"==c("dev")&&(t.dev=!0),"true"==c("preview")&&(t.preview=!0),JSON.stringify(t)}(m.slots[s].name,m.slotParams[m.slots[s].name]))}(e)}function g(e,t){if("preview"!==e){var n=JSON.parse(b("_bsft_message_actions")||"{}"),t=h[t]||t,e=e.substring(0,8)+"."+t,t=Math.floor(Date.now()/1e3),o=!1;for(l in n)if(-1<l.indexOf("-")||12<l.length){o=!0;break}if(o){var i={};for(l in n){var r,s=l.lastIndexOf(".");-1<s&&(r=l.substring(0,s).substring(0,8),s=l.substring(s+1),i[s=r+"."+(h[s]||s)]=(i[s]||[]).concat(n[l]))}n=i}for(l in(n[e]||(n[e]=[])).push(t),n)20<n[l].length&&(n[l]=n[l].slice(-20));var a=0;for(l in n)a+=n[l].length;if(300<a){var c=[];for(l in n)for(var u=0;u<n[l].length;u++)c.push({key:l,time:n[l][u],index:u});c.sort(function(e,t){return t.time-e.time});for(var l,f={},u=0;u<Math.min(300,c.length);u++){var d=c[u];f[d.key]||(f[d.key]=[]),f[d.key].push(d.time)}for(l in n={},f)n[l]=f[l].sort(function(e,t){return e-t})}w("_bsft_message_actions",JSON.stringify(n),365)}}function r(e){e&&(m.slotParams=e),function(){m.slots=[];for(var e=document.querySelectorAll("[data-bsft-slot]"),t=0;t<e.length;t++){var n=e[t].dataset.bsftSlot;m.slots.push({name:n,el:e[t]})}Object.keys(m.slotParams).forEach(function(t){!0!==m.slotParams[t].popup&&"lightbox"!==t||m.slots.some(e=>e.name===t)||m.slots.push({name:t})})}(),i()}function p(e){try{var t=y();t.open("GET",e,!0),t.send(e)}catch(e){}}function y(){if(window.XMLHttpRequest)try{var t=new XMLHttpRequest}catch(e){t=new window.ActiveXObject("Microsoft.XMLHTTP")}return t}function w(e,t,n){var o=new Date;o.setDate(o.getDate()+n);var i=window.location.hostname,r=i.split(".");4==r.length&&0<=r[0]&&r[0]<=255&&0<=r[1]&&r[1]<=255&&0<=r[2]&&r[2]<=255&&0<=r[3]&&r[3]<=255||(i="."+i.replace(/^www./,""));i=escape(t)+(null==n?"":";expires="+o.toUTCString())+";path=/;domain="+i+";SameSite=Strict;Secure;";document.cookie=e+"="+i}function b(e){for(var t,n,o=document.cookie.split(";"),i=0;i<o.length;i++)if(t=o[i].substr(0,o[i].indexOf("=")),n=o[i].substr(o[i].indexOf("=")+1),(t=t.replace(/^\s+|\s+$/g,""))==e)return unescape(n)}function c(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function s(e){var t,n=e[0],o=function(){var t="";try{t=window.top.document.referrer}catch(e){if(window.parent)try{t=window.parent.document.referrer}catch(e){t=""}}return t=""===t?document.referrer:t}(),i=Math.floor(1e6*Math.random()+1),r=Math.round(new Date/1e3),s=b("_bs");if("object"==typeof analytics&&"function"==typeof analytics.user)try{var a,c=analytics.user();"function"==typeof c.anonymousId?(a=c.anonymousId(),s!==a&&(w("_bs",a,365),s=a)):analytics.user().then(function(e){e=e.anonymousId();s!==e&&(w("_bs",e,365),s=e)}).catch(function(e){console.debug("Error getting analytics user:",e)})}catch(e){console.debug("Error with legacy analytics approach:",e)}function u(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}if(w("_bs",void 0===s?s=u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u():s,365),"config"==n&&e[1])return d=e[1],1;if("identify"==n&&(m.userParams=e[1]||{},m.userParams.cookie=s),"track"==n)n=e[1],e=e[2],"dismiss"===n&&(console.log("Dismissing lightbox event",n,e),e.eid&&g(e.eid,"dismiss"));else{if("retarget"==n)return 1;e=e[1]}for(t in req=l+"?t="+r+"&e="+n+"&r="+encodeURIComponent(o)+"&z="+i+"&x="+window._blueshiftid+"&k="+s+"&u="+encodeURIComponent(window.location.href),e)v=e[t],"object"==typeof v?req+="&"+t+"_json="+encodeURIComponent(JSON.stringify(v)):req+="&"+t+"="+encodeURIComponent(v);return f?d.usePOST?((e=null==e?{}:e).t=r,e.e=n,e.r=o,e.z=i,e.x=window._blueshiftid,e.k=s,e.u=window.location.href,function(e,t){try{var n=y();n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))}catch(e){}}(l,e)):p(req):(i=req,new Image(1,1).src=i),1}function a(e,t){setTimeout(function(){u(e)},t)}function u(e){null!=e[0]&&(n?"identify"!==e[0]&&"config"!==e[0]?m.userParams.cookie||1e3<new Date-o?"live"===e[0]?r(e[1]):s(e):a(e,20):s(e):a(e,20))}function e(){n=!0,o=new Date,m.eventApiKey=_blueshiftid;var e=new CustomEvent("blueshift-ready",{config:d});document.dispatchEvent(e),window.addEventListener("message",function(e){e.origin===window.location.origin&&"bsft"===e.data.type&&("identify"===e.data.event?u(["identify",e.data.payload]):u(["track",e.data.event,e.data.payload]))},!1)}if("object"==typeof blueshift){var _=void 0===blueshift.slice?[]:blueshift.slice(0);for(blueshift={events:[],load:function(){e()},retarget:function(){u(["retarget"])},track:function(e,t){u(["track",e,t])},pageload:function(e){u(["pageload",e])},identify:function(e){u(["identify",e])},live:function(e){u(["live",e])},sendXHR:p},x=0;x<_.length;x++)blueshift.events.push(_[x])}for(var x=0;x<blueshift.events.length;x++)u(blueshift.events[x]);"complete"===document.readyState?e():window.addEventListener("load",e,!1)}();