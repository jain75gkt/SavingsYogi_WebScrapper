var postid=document.getElementById('postID').value;var RateTheArticle={send:function(postid,vote,why){var postid=document.getElementById('postID').value;var xhr=new XMLHttpRequest();var url='/wp-admin/admin-ajax.php?action=vote';xhr.open('POST',url,true);xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');xhr.withCredentials=false;var params='vote_type='+encodeURIComponent(vote)+'&post_id='+encodeURIComponent(postid);if(why&&why.length){params=params+'&response='+encodeURIComponent(why);}
xhr.onreadystatechange=function(){if(xhr.readyState===4){var text='';if(xhr.status===200){RateTheArticle.setVotedCookie(postid);text='Thanks for voting!';}else{text='Sorry, there was a problem during voting.';}
RateTheArticle.showSecondPage(text);}};xhr.send(params);},setVotedCookie(postid){const d=new Date();d.setTime(d.getTime()+(365*24*60*60*1000));let expires="expires="+d.toUTCString();document.cookie='vp-'+postid+'=1;'+expires+";path=/";},showSecondPage:function(text){$("#rate-the-article #response").text(text);this.toggleWhy(false);Pages.openPage2('#rate-the-article');},submit:function(){this.disableAllControls();var postid=document.getElementById('postID').value;var why=$('#rate-the-article #mbt-field-why').val();RateTheArticle.send(postid,'downvote',why);},yes:function(){var postid=document.getElementById('postID').value;this.disableAllControls();RateTheArticle.send(postid,'upvote');},no:function(){this.toggleWhy(true);},disableAllControls:function(){$('#rate-the-article #yes').attr('disabled',true);$('#rate-the-article #no').attr('disabled',true);$('#rate-the-article #submit-button').attr('disabled',true);$('#rate-the-article #mbt-field-why').attr('disabled',true);},toggleWhy:function(show){if(show){$('#rate-the-article #js-what-was-wrong').removeClass('d-none');}else{$('#rate-the-article #js-what-was-wrong').addClass('d-none');}},checkForExistingVote:function(){if(getCookie('vp-'+postid)||getCookie('mbt_mbtdb-models-wordpress-post_'+postid)||getCookie('wordpress-post_'+postid)){const element=document.getElementById("rate-the-article");element.remove();}},initForm:function(){var self=this;self.postid=Helper.hashParams['post-id'];var form=document.getElementById('rateArticle');form.addEventListener('submit',function(event){if(form.checkValidity()===false){return;}
event.preventDefault();event.stopPropagation();self.submit();});self.checkForExistingVote();}};document.addEventListener('DOMContentLoaded',function(){RateTheArticle.initForm();});function getCookie(cname){let name=cname+"=";let decodedCookie=decodeURIComponent(document.cookie);let ca=decodedCookie.split(';');for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";}