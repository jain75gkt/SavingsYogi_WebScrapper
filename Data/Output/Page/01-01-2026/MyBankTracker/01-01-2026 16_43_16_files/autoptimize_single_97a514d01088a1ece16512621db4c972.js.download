var Helper={widgetMetaData:{},config:{},widgetParams:{},defaultParams:{},configParams:{},hashParams:{},params:{},publisher:null,readHash:null,closed:false,injectedWidgetId:'___WIDGET-ID___',isInjected:('___WIDGET-ID___'.indexOf('___WIDGET-ID__')===-1),screenWidth:null,screenMode:null,screenDevice:null,listeners:{},adDisclosureModal:function(on,event){var elems=document.getElementsByClassName('js-ad-disc-elem');if(on===true){for(var i=0;i<elems.length;i++){Helper.removeClass(elems[i],'ng-hide');}}else{for(var i=0;i<elems.length;i++){Helper.addClass(elems[i],'ng-hide');}}},fillHashParams:function(){this.hashParams={};this.readHash='';if(this.isInjected){this.readHash=this.readJson('hash','');}else{this.readHash=window.location.hash;}
if(this.readHash){var hash=this.readHash.substring(1);if(hash[0]==='/')hash=hash.substring(1);if(hash[0]==='?')hash=hash.substring(1);var parts=hash.split('&');for(var i=0;i<parts.length;i++){var p=parts[i].split('=');var name=p[0];var value;if((p.length>1)&&(p[1]!=null))value=decodeURIComponent(p[1]);this.hashParams[name]=value;}}},fillParams:function(){var p={};for(var k in this.defaultParams){p[k]=this.defaultParams[k];}
for(var k in this.configParams){p[k]=this.configParams[k];}
for(var k in this.hashParams){p[k]=this.hashParams[k];}
this.params=p;},readJson:function(id,fallback){try{if(this.isInjected){id='mbt--'+id+'--'+this.injectedWidgetId;}
var elem=document.getElementById(id);if(elem){return JSON.parse(elem.innerHTML);}}catch(e){console.error(e);}
return fallback;},readPublisher:function(){try{this.publisher=readJson('publisher');}catch(e){console.error(e);}},removeClass:function(e,klass){var pattern="(?:^|\\s)"+klass+"(?!\\S)";var re=new RegExp(pattern,"g");e.className=e.className.replace(re,'');},addClass:function(e,klass){e.className=e.className+" "+klass;},fillDefaultParams:function(){var self=this;var fill=function(attrs){if(attrs&&attrs.length){for(var i=0;i<attrs.length;i++){if(attrs[i].default!==undefined){self.defaultParams[attrs[i].name]=attrs[i].default;}}}}
fill(self.widgetParams.reqAttrs);fill(self.widgetParams.optAttrs);if(self.widgetParams.defaults){for(var k in self.widgetParams.defaults){self.defaultParams[k]=self.widgetParams.defaults[k];}}
var defaultConfig="default/"+self.widgetMetaData.widget_name;if(self.widgetMetaData.widget_configs&&self.widgetMetaData.widget_configs[defaultConfig]){var config=self.widgetMetaData.widget_configs[defaultConfig];if(config&&config.params){try{for(var k in config.params){self.defaultParams[k]=config.params[k];}}catch(e){console.error(e);}}}},fillConfigParams:function(){this.configParams={};if(this.widgetMetaData.widget_configs&&this.hashParams.config&&this.hashParams.config.length){var config=this.widgetMetaData.widget_configs[this.hashParams.config];if(config&&config.params){try{for(var k in config.params){this.configParams[k]=config.params[k];}}catch(e){console.error(e);}}}},mbtContentElement:function(){if(Helper.isInjected){return document.getElementById(Helper.injectedWidgetId);}else{return document.body;}},mbtWrapperElement:function(){if(Helper.mbtContentElement()){var elem=Helper.mbtContentElement().getElementsByClassName('mbt--app-wrapper')[0];return elem;}else{return null;}},closeWidget:function(){if(Helper.closed===true)return;Helper.closed=true;if(ipc){ipc.sendToWidgetLoader('collapse-me');}
Helper.addClass(Helper.mbtContentElement(),'mbt--closed-widget-background');},screenWidthUpdated:function(){var elem=this.mbtWrapperElement();if(!elem){return;}
var width=elem.clientWidth;if(width===this.screenWidth){return;}
this.screenWidth=width;var mode=null;var device=null;if(width<576){mode='xs';}else if(width<768){mode='sm';}else if(width<992){mode='md';}else if(width<1200){mode='lg';}else{mode='xl';}
if(mode==='xs'){device='mobile';}else if(mode==='sm'){device='smtablet';}else if(mode==='md'){device='lgtablet';}else{device='desktop';}
if(mode===this.screenMode){return;}
this.screenMode=mode;this.screenDevice=device;var allClasses=['mbt--size-xs','mbt--size-sm','mbt--size-md','mbt--size-lg','mbt--size-xl','mbt--size-mobile','mbt--size-smtablet','mbt--size-lgtablet','mbt--size-desktop'];for(var i=0;i<allClasses.length;i++){Helper.removeClass(elem,allClasses[i]);}
if(this.config.atf_css_extraction_mode===true){for(var i=0;i<allClasses.length;i++){Helper.addClass(elem,allClasses[i]);}}else{this.addClass(elem,'mbt--size-'+mode);this.addClass(elem,'mbt--size-'+device);}
Helper.callListeners('resize',mode,device);},debounce:function(fn,timeout){var _this=this;if(timeout==null)timeout=100;var timer;return function(){var args=arguments;clearTimeout(timer);timer=setTimeout(function(){fn.apply(_this,args);},timeout);};},observeScreenWidth:function(){if(window.ResizeObserver){var self=this;var onResizeFn=function(entries){if(entries&&entries.length){self.screenWidthUpdated();}}
var resizeObserver=new ResizeObserver(Helper.debounce(onResizeFn,0));resizeObserver.observe(this.mbtContentElement());}},getParentLocation:function(){var location=null;if(Helper.hashParams['ref']){location=Helper.hashParams['ref'];}else if(Helper.isInjected){location=window.location;}
return location;},sendPaidClickEvent:function(customPayload){ipc.sendToWidgetLoader('paid-click-event',{custom_payload:customPayload});},sendDebugInfoParams:function(){if((this.params['_debug']==='true')&&ipc){ipc.sendToWidgetLoader('debug-info',{infoType:'params',details:this.params})}},addListener:function(name,fn){Helper.listeners[name]=Helper.listeners[name]||[];Helper.listeners[name].push(fn);},callListeners:function(){var _this=this;var name=arguments[0];var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}
var fns=Helper.listeners[name]||[];for(var i=0;i<fns.length;i++){fns[i].apply(_this,args);}},initWidget:function(){this.widgetMetaData=this.readJson('widget-meta-data',this.widgetMetaData);this.widgetParams=this.readJson('widget-params',this.widgetParams);this.config=this.readJson('config',this.config);this.publisher=this.config.publisher;this.fillDefaultParams();this.fillHashParams();this.fillConfigParams();this.fillParams();this.screenWidthUpdated();this.observeScreenWidth();this.sendDebugInfoParams();}};window.Helper=Helper;